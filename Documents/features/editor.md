# Feature: エディタ基本機能 (Editor Features)

## 1. Overview
メイン描画エリア（キャンバス）における、精密な編集を支援するための機能群です。グリッド表示による視覚的補助、画像の変形（スケーリング）、および効率的な編集を可能にするコピー＆ペースト機能を含みます。

## 2. Data Model

### 2.1 GridSettings
グリッドの表示間隔とオフセットを定義します。
- `CellSize`: グリッドの一区画のサイズ（幅・高さ）
- `Offset`: グリッドの開始位置
- `Padding`: セル間の余白

### 2.2 Selection
現在の選択範囲の状態を管理します。
- `Area`: 選択範囲の座標とサイズ
- `Picture`: 選択範囲内の画像データ（コピー・移動用）

## 3. Logic & Behavior

### 3.1 表示支援 (Grid Display)
- **1pxグリッド**: 拡大倍率 x4 以上で表示されるピクセル単位の補助線。精密なドット打ちを支援します。
- **カーソルグリッド**: 現在のブラシサイズまたは選択グリッド単位で表示される補助線。全倍率で表示可能です。
- **UI連携**: ツールバーのトグルボタンで個別に ON/OFF が可能です。

### 3.2 画像変形 (Scaling)
- **スケーリング**: 画像全体のサイズを変更します。
- **アルゴリズム**: 最近傍法（Nearest Neighbor）を採用し、ドットの輪郭を崩さずに拡大・縮小を行います。

### 3.3 コピー＆ペースト (Clipboard Operations)
- **コピー/切り取り**: 選択範囲がある場合はその範囲を、ない場合はキャンバス全体を対象とします。
- **貼り付け (Floating Selection)**:
    - 貼り付けられた画像は即座に「移動可能」な選択状態（Floating Selection）になります。
    - ユーザーが位置を決定（クリックまたは Enter）するまで、元画像とは分離して保持されます。

### 3.4 履歴管理 (Undo/Redo)
- 全ての描画、スケーリング、および貼り付け操作はグローバルな履歴（DrawingSession）に記録されます。
- ドックへの反映操作（Pull）も履歴に含まれ、個別のドック画像を元の状態に戻すことが可能です。

## 4. Constraints
- **描画パフォーマンス**: グリッドはオーバーレイとして描画され、画像データそのものは変更しません。
- **選択範囲の制約**: 貼り付けられた画像がキャンバス外にはみ出した場合、確定時にキャンバス外のピクセルは破棄されます。