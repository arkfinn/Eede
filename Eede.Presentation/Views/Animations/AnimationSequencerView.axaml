<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Eede.Presentation.ViewModels.Animations"
             xmlns:anim="clr-namespace:Eede.Domain.Animations;assembly=Eede.Domain"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="150"
             x:Class="Eede.Presentation.Views.Animations.AnimationSequencerView"
             x:DataType="vm:AnimationViewModel"
             x:Name="root">
  <Grid RowDefinitions="Auto, Auto, *">
    <TextBlock Grid.Row="0" Text="Sequencer" Classes="header" Margin="4"/>

    <!-- Section: Wait Time -->
    <StackPanel Grid.Row="1" Spacing="4" Margin="8,0,8,8">
      <TextBlock Text="Next Frame Wait Time (ms)" FontSize="11" FontWeight="Bold"/>
      <NumericUpDown Value="{Binding WaitTime}" Minimum="10" Maximum="5000" Increment="10" Height="28"/>
    </StackPanel>
    
    <ScrollViewer Grid.Row="2" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
      <ListBox ItemsSource="{Binding SelectedPattern.Frames}" 
               Background="Transparent" BorderThickness="0"
               Padding="0">
        <ListBox.ItemsPanel>
          <ItemsPanelTemplate>
            <StackPanel Orientation="Vertical" Spacing="2" Margin="4"/>
          </ItemsPanelTemplate>
        </ListBox.ItemsPanel>
        <ListBox.Styles>
          <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0"/>
          </Style>
        </ListBox.Styles>
        <ListBox.ItemTemplate>
          <DataTemplate x:DataType="anim:AnimationFrame">
            <Border BorderBrush="Gray" BorderThickness="1" Height="32" x:Name="FrameBorder">
              <Grid ColumnDefinitions="30, *, 30">
                <Panel Grid.Column="0" Background="DarkGray">
                  <TextBlock Text="{Binding CellIndex}" 
                             HorizontalAlignment="Center" VerticalAlignment="Center" 
                             FontSize="12"/>
                </Panel>
                <TextBlock Grid.Column="1" Text="{Binding Duration, StringFormat='{}{0}ms'}" FontSize="10" VerticalAlignment="Center" Margin="8,0,0,0"/>
                <Button Grid.Column="2" Content="✕" Padding="0"
                        Command="{Binding #root.ViewModel.RemoveFrameAtCommand}"
                        CommandParameter="{Binding .}"
                        ToolTip.Tip="フレーム削除"
                        Background="Transparent" BorderThickness="0" Foreground="Red" FontWeight="Bold"/>
              </Grid>
            </Border>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </ScrollViewer>
  </Grid>
</UserControl>
