<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:general="using:Eede.Presentation.Views.General"
             xmlns:local="using:Eede.Presentation.Views.DataEntry"
             xmlns:vm="using:Eede.Presentation.ViewModels.DataEntry"
             xmlns:converters="using:Eede.Presentation.Common.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Eede.Presentation.Views.DataEntry.DrawableCanvas"
             x:DataType="vm:DrawableCanvasViewModel"
             Cursor="{Binding ActiveCursor}"
             IsShifted="{Binding IsShifted}"
             PointerLeftButtonPressedCommand="{Binding DrawBeginCommand}"
             PointerRightButtonPressedCommand="{Binding PointerRightButtonPressedCommand}"
             PointerMovedCommand="{Binding DrawingCommand}"
             PointerLeftButtonReleasedCommand="{Binding DrawEndCommand}"
             PointerLeaveCommand="{Binding CanvasLeaveCommand}">
  <UserControl.Resources>
    <converters:BackgroundColorConverter x:Key="BackgroundColorConverter"/>
    <converters:PictureToBitmapConverter x:Key="PictureToBitmapConverter"/>
    <converters:MagnificationToDoubleConverter x:Key="MagnificationToDoubleConverter"/>
  </UserControl.Resources>
  <Design.DataContext>
    <vm:DrawableCanvasViewModel />
  </Design.DataContext>

  <Panel Background="{DynamicResource BaseBrush}">
    <Panel>
      <Panel.Background>
        <ImageBrush Source="/Assets/Tiles/OutsideBackGround.bmp"
                    Stretch="None"
                    TileMode="Tile"
                    SourceRect="0,0,16,16"
                    DestinationRect="0,0,16,16"
                    AlignmentY="Top"
                    AlignmentX="Left"/>
      </Panel.Background>
      <Panel x:Name="background"
             Width="{Binding DisplayWidth}"
             Height="{Binding DisplayHeight}">
        <Panel.Background>
          <ImageBrush Source="/Assets/Tiles/InvisibleBackground.png"
                      Stretch="None"
                      TileMode="Tile"
                      SourceRect="0,0,16,16"
                      DestinationRect="0,0,16,16"
                      AlignmentY="Top"
                      AlignmentX="Left"/>
        </Panel.Background>
        <Panel Width="{Binding DisplayWidth}"
              Height="{Binding DisplayHeight}" >
          <Panel.Background>
            <SolidColorBrush Color="{Binding BackgroundColor, Converter={StaticResource BackgroundColorConverter}}"/>
          </Panel.Background>
        </Panel>
        <Image x:Name="canvas"
               Stretch="Fill"
               Focusable="True"
               Source="{Binding MyBitmap}"
               Width="{Binding DisplayWidth}"
               Height="{Binding DisplayHeight}"
               RenderOptions.BitmapInterpolationMode="None"/>
        <local:GridOverlay Width="{Binding DisplayWidth}"
                           Height="{Binding DisplayHeight}"
                           IsShowPixelGrid="{Binding IsPixelGridEffectivelyVisible}"
                           IsShowCursorGrid="{Binding IsCursorGridEffectivelyVisible}"
                           Magnification="{Binding Magnification}"
                           CursorSize="{Binding CursorSize}"
                           BackgroundColor="{Binding BackgroundColor.Value}"
                           IsHitTestVisible="False"/>
        <general:Region IsVisible="{Binding IsRegionSelecting}"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Margin="{Binding SelectingThickness}"
                        Width="{Binding SelectingSize.Width}"
                        Height="{Binding SelectingSize.Height}" 
                        ShowHandles="{Binding IsShowHandles}"
                        HandleSize="{Binding HandleSize}"
                        HandleMargin="{Binding HandleMargin}"
                        IsHitTestVisible="False" />

      </Panel>
    </Panel>
  </Panel>
</UserControl>
