# トラック仕様書: 非破壊プレビュー付きコピー＆ペーストの改善

## 1. 概要
現在のコピー＆ペースト操作はペーストした瞬間にキャンバスが書き換えられますが、これを「プレビュー（未確定）状態」を介する方式に改善します。ユーザーはペーストした画像を確定させる前に自由に位置を調整でき、確定するまでは元のキャンバス画像が保持される（非破壊적）ようにします。

## 2. 機能要件
- **ペースト時の挙動:**
    - ペースト実行直後、コピーされた画像が元の選択範囲と同じ位置に「プレビュー」として表示される。
    - 状態は自動的に「範囲選択ツール」の移動モード（プレビュー状態）に移行する。
- **プレビュー中の操作:**
    - プレビュー画像をドラッグして自由に移動できる。
    - 移動中、プレビュー画像の下にある元のキャンバス画像は消えずに表示され続ける（非破壊）。
- **確定（コミット）トリガー:**
    - 以下の操作が行われた際、プレビュー画像の位置でキャンバスへの書き込みを確定させる。
        - プレビュー範囲外のキャンバスをクリックする。
        - 別のツール（ペンツールなど）に切り替える。
        - 新しいコピー、ペースト、または別の編集操作を開始する。
- **Undo/Redo:**
    - Undoを実行すると、プレビュー中の移動履歴は無視し、ペースト操作そのものを取り消してペースト前の状態に戻る。

## 3. 非機能要件
- **既存アーキテクチャの活用:**
    - `DrawingSession` が保持する `SelectionPreviewInfo` の仕組みを拡張し、ペースト時にもこの未確定状態を利用する。
- **パフォーマンス:**
    - プレビューの描画負荷が操作感（フレームレート）に影響を与えないこと。
- **DDD/レガシー改善:**
    - 知識を `UseCase` や `ViewModel` からドメインモデル（`DrawingSession`）へ返却する。
    - 仕様化テストにより既存機能のデグレードを防止する。

## 4. 受け入れ基準
- [ ] ペースト実行後、画像が即座に確定されず、移動可能な状態で表示されること。
- [ ] プレビュー画像を移動させても、元の位置の画像が欠損していないこと。
- [ ] 範囲外クリックで画像が正しくキャンバスに転記（確定）されること。
- [ ] ツールを切り替えた際に、それまでのプレビューが確定されること。
- [ ] Undo 1回でペースト前の状態に完全に戻ること。
