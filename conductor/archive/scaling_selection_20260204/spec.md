# Track Specification: 選択範囲の拡大縮小 (Scaling Selection)

## 概要
既存の「矩形選択ツール」を拡張し、選択範囲（および選択された画像）の拡大縮小機能を追加する。
選択範囲の四隅および四辺の中点にハンドルを表示し、ドラッグ操作によって直感的に変形を行えるようにする。
変形中はピクセルデータもリアルタイムに追従（ニアレストネイバー補間）し、Shiftキーによるアスペクト比維持などの補助機能を提供する。

## 機能要件

### 1. 拡大縮小操作
- **ハンドル表示:**
    - 選択範囲が存在する場合、その境界ボックスの四隅（4点）と各辺の中点（4点）、計8点のハンドルを表示する。
    - ハンドルにマウスカーソルを合わせると、操作方向に応じたカーソル形状（SizeNWSE, SizeNS 等）に変更する。
- **ドラッグによる変形:**
    - ハンドルをドラッグすることで、選択範囲のサイズを変更できる。
    - **四隅:** 縦横比を自由に変更（デフォルト）。
    - **辺の中点:** 縦方向または横方向のみサイズ変更。
- **キーボード修飾:**
    - **Shiftキー:** アスペクト比を維持したまま拡大縮小を行う。
- **制約:**
    - 幅および高さは最小 1px までとし、それ以下には縮小できない（反転はしない）。

### 2. プレビュー表示
- **リアルタイム変形:**
    - ドラッグ中、選択されている画像（Floating Image）も新しいサイズに合わせてリアルタイムに拡大縮小表示する。
    - 拡大縮小アルゴリズムには、ドット絵に適した「ニアレストネイバー法（最近傍補間）」を使用する。

### 3. 確定とキャンセル
- **確定タイミング:**
    - 以下の操作を行った時点で、変形後の画像がキャンバスに描画（合成）され、操作が完了する。
        - 選択範囲外をクリックした時
        - 別のツールに切り替えた時
        - 選択範囲の解除操作を行った時
- **キャンセル:**
    - Esc キー押下や Undo 操作により、変形操作を取り消し、変形前の状態に戻すことができる。

## 非機能要件
- **パフォーマンス:** 拡大縮小のプレビューは、マウスドラッグに追従して遅延なくスムーズに更新されること。
- **既存機能との整合性:**
    - 既存の「移動（Move）」や「貼り付け（Paste）」時のプレビュー状態 (SelectionPreviewInfo) の仕組みと整合性を保つ。
    - ドット絵エディタとしての挙動（アンチエイリアスなし）を厳守する。

## 許容条件 (Acceptance Criteria)
1. 選択範囲を作成すると、8つのハンドルが表示されること。
2. 各ハンドルをドラッグして、選択範囲と画像を拡大縮小できること。
3. Shiftキーを押しながらドラッグすると、アスペクト比が維持されること。
4. 1px以下に縮小できないこと。
5. 拡大縮小中、画像がボケずに（ニアレストネイバーで）表示されること。
6. 確定操作を行うと、変形された画像がキャンバスに正しく描き込まれること。

## 範囲外 (Out of Scope)
- 回転（Rotation）機能
- 自由変形（Skew/Distort）機能
