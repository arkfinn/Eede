# 製品ガイドライン

## デザイン哲学: モダン・ワークエリア・スタイル
- **インスピレーション:** 「キャラクターツクール」や「キャラクターレイザー1999」に見られる、実用性と没入感を兼ね備えた「作業エリア式」エディタの系譜を継承します。
- **UI/UX:** 洗練されたモダンで機能的なデザイン（Material Design/Fluent Designなど）を採用しつつ、ドット絵制作に特化した無駄のない操作感を提供します。
- **体験:** ツール自体がクリエイター（開発者自身）のテンションを上げ、創作意欲を刺激するような、美しく使い心地の良いインターフェースを目指します。

## エンジニアリング指針
1.  **堅牢性と保守性 (最優先):**
    -   厳格な型システムと、テスト駆動開発 (TDD) をベースとした開発プロセスを徹底します。
    -   長期的なメンテナンスに耐えうる、Clean Architecture や DDD (Domain-Driven Design) の原則に基づいた設計を行います。
2.  **柔軟性と進化:**
    -   堅牢な基盤の上に、ユーザーのフィードバックや自身の新しいアイデアを柔軟に取り込める拡張性を確保します。
3.  **パフォーマンス:**
    -   大画面での作業やアニメーションプレビューでもストレスを感じさせない、快適なレスポンスを維持します。

## ブランドメッセージ
「**プロフェッショナルのための、究極のドット絵スタジオ**」
- 開発者自身が「最強のユーザー」として納得できる、妥協のないツール作り。
- 1ピクセルに魂を込めるクリエイターのための、信頼できるパートナー。

## 技術的知見 (Lessons Learned)

### Avalonia 11 クリップボード連携
- **データの冗長化:** `IClipboard.GetDataAsync("Bitmap")` は、OSや他アプリとの兼ね合いで `null` を返すことが多いため、コピー時には `"PNG"` (byte[]) 形式なども同時にセットし、ペースト時にフォールバックを試みるのが安全です。
- **グローバルショートカット:** `UserControl` (`MainView`) の `KeyBindings` はフォーカス状態に左右されやすいため、アプリ全体で共通のショートカット（Ctrl+C/Vなど）は `Window` (`MainWindow`) に定義するのが確実です。
- **ファイルアクセス:** クリップボードやドラッグ＆ドロップで得られる `IStorageItem` は、`OfType<IStorageFile>()` でフィルタリングしてから `OpenReadAsync()` を呼び出す必要があります。

### ポリモーフィックな Undo/Redo
- **異種履歴の一元管理:** メインの編集対象（キャンバス）以外への操作を履歴に含める場合、`IHistoryItem` 等で抽象化し、`Undo()` / `Redo()` の戻り値として「何が戻されたか」を通知する設計にすると、UI側での副作用（ドックの画像復元等）を安全に適用できます。
- **Before/Afterの状態保持:** Redo 機能を正しく動作させるためには、履歴アイテムに変更前（Before）と変更後（After）の両方の状態を保持させるのが確実です。

### 動的な視認性調整
- **背景への適応:** グリッドやガイドなどのオーバーレイ要素は、背景色の輝度（Luminance）を算出し、補色や明度差のある色を自動選択することで、あらゆる編集状況下での視認性を確保します。
