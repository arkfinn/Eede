# トラック仕様: ビルド時のワーニング解消とレガシーコードのリファクタリング

## 1. 概要
本トラックでは、Eede プロジェクトの技術的負債を解消し、長期的な保守性を確保するため、段階的なリファクタリングを実施する。
主要な目標は、Null 許容参照型 (Nullable Reference Types) の導入、インフラ層の近代化、およびコードスタイルの統一である。

## 2. 目的と範囲
「コース A (ドメイン堅牢化) → コース C (インフラ刷新) → コース B (コード清掃)」の順序で実施し、特に依存関係の核となる `Eede.Domain` から着手する。

### 段階的アプローチ (優先順位)
1.  **段階的有効化 (`#nullable enable`):** ファイル単位での段階的な導入。
2.  **共通基盤領域 (`SharedKernel`, `Files`):** 依存される側の基盤クラスの堅牢化。
3.  **仕様化テストの徹底:** 重要ロジック変更前の挙動固定。
4.  **画像編集の核心 (`DrawingSession` 等):** メイン機能の Null 安全化とモデル改善。
5.  **プレゼンテーション層の刷新:** 下位層の Null 安全化の恩恵を受けた ViewModel 等の警告一掃。

## 3. 機能要件 (リファクタリング項目)
### コース A: ドメイン堅牢化
- `Eede.Domain` 内の各ファイルを `#nullable enable` に変更。
- Null 警告に対して、単なる `!` (null 抑制演算子) の追加ではなく、以下の DDD 的な解決を図る。
    - コンストラクタでの初期化強制。
    - 妥当性検証の追加。
    - 必要に応じた `Option` パターンの検討。
- 変更前に「仕様化テスト」を作成し、既存の挙動を破壊していないことを保証する。

### コース C: インフラ刷新
- `Eede.Infrastructure` および関連する外部ライブラリ依存の更新。
- `Obsolete` (非推奨) 警告の解消。
- インターフェース定義の再確認と、必要に応じた DIP (依存性の逆転) の強化。

### コース B: コード清掃
- `.editorconfig` に基づくコードスタイルの自動整形。
- 未使用の `using`、変数の削除。
- 最新の C# 構文 (Target-typed new, Primary constructors 等) への適合。

## 4. 非機能要件
- **回帰テスト:** 既存の単体テスト、UIテスト、結合テストが全てパスすること。
- **パフォーマンス:** リファクタリングによる極端なパフォーマンス低下を招かないこと。
- **メモリ管理:** `Bitmap` 等のリソース破棄 (`Dispose`) が適切に行われている状態を維持すること。

## 5. 受け入れ条件 (Acceptance Criteria)
- [ ] `Eede.Domain` の全ファイルで `Nullable` 警告がゼロであること。
- [ ] `Eede.Presentation` を含む全プロジェクトで `Nullable` 警告が解消されていること。
- [ ] ビルド時に発生するその他の警告 (コードスタイル、非推奨 API 等) がゼロであること。
- [ ] 全てのテストスイート (`Eede.*.Tests`) がパスすること。
- [ ] 新しく作成した仕様化テストが、リファクタリング後の挙動を正しく検証していること。

## 6. アウトオブスコープ (実施しないこと)
- 新機能の追加。
- 既存の不具合修正（リファクタリング中に発見した場合は、別途チケット化するか、最小限の修正に留める）。
- UI デザインの変更。
