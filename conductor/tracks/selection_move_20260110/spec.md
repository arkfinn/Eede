# 選択範囲の移動機能の仕様書

## 概要
ユーザーが選択したピクセル領域を、ドラッグ操作によってキャンバス内の別の位置へ移動できる機能を提供します。直感的な操作感と、失敗時のキャンセル機能を備えた堅牢な実装を目指します。

## 機能要件
- **ドラッグ開始時の挙動:**
    - 選択範囲内で左クリックしてドラッグを開始した瞬間に、元の位置のピクセルデータを一時バッファに退避し、元の位置は空白（または背景色）で塗りつぶします。
- **ドラッグ中の表示:**
    - マウスカーソルの移動に合わせて、退避したピクセルデータがプレビューとして表示されます。
- **移動の確定 (左ボタン MouseUp):**
    - マウスを離した位置にピクセルデータを書き込みます。
    - 移動後の新しい位置に、選択範囲（点線などの枠）を維持します。
- **キャンバス外への対応:**
    - 選択範囲をキャンバス外へ移動させることを許可します。
    - ただし、確定時にキャンバス外にはみ出しているピクセルデータは切り捨てられます。
- **キャンセル機能 (ドラッグ中の右クリック):**
    - ドラッグ中に右クリックされた場合、移動を中止し、画像をドラッグ開始前の状態に完全に復元します。
    - 状態はドラッグ前の「範囲選択済み」の状態に戻ります。
- **Undo/Redo 対応:**
    - 「ピクセルの切り取り」から「新しい位置への配置」までを1つのアトミックな操作として記録し、Undo/Redoが可能であること。

## 非機能要件
- **パフォーマンス:** ドラッグ中のプレビュー表示がスムーズに行われること。
- **ドメイン整合性:** `Picture` クラスや `Selection` クラスなどのドメインオブジェクトを活用し、クリーンアーキテクチャに準拠した実装を行う。

## 対象外 (Out of Scope)
- 複数レイヤーを跨いだ移動。
